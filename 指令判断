app:
  description: ç”¨äºååŠ©ç”Ÿæˆé¢„å®šä»“ä½çš„ä¸‹å•
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: æµ‹è¯•åº”ç”¨
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/siliconflow:0.0.7@8b9d2f57d314120744c245b6fe4f8701e1a7490a500d9fb74e9e9dceeaea5f70
kind: app
version: 0.1.5
workflow:
  conversation_variables:
  # ...ä¿ç•™åŸæœ‰å˜é‡...
  # ğŸš¨æ–°å¢å˜é‡
  - description: æ¯›é‡
    id: 3c5158b5-fed0-42b3-8d93-d36f639829e1
    name: GrossWeight
    selector:
    - conversation
    - GrossWeight
    value: ''
    value_type: string
  - description: é›†è£…ç®±ç±»å‹
    id: afc9d6fb-ede7-4543-a2ea-8fca6266a058
    name: ContainerType
    selector:
    - conversation
    - ContainerType
    value: ''
    value_type: string
  environment_variables:
  # ğŸš¨æ–°å¢é‚®ä»¶é…ç½®
  - key: SMTP_SERVER
    value: 'smtp.example.com'
  - key: SMTP_PORT
    value: '587'
  - key: EMAIL_USER
    value: 'sender@example.com'
  - key: EMAIL_PASSWORD
    value: 'password123'
  features:
    # ...ä¿ç•™åŸæœ‰ç‰¹å¾é…ç½®...
  graph:
    edges:
    # ...ä¿ç•™åŸæœ‰è¿æ¥å…³ç³»...
    # ğŸš¨æ–°å¢é‚®ä»¶èŠ‚ç‚¹è¿æ¥
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: code
      id: 1744043997052-source-1744044999999-target
      source: '1744043997052'
      sourceHandle: source
      target: '1744044999999'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    # ğŸš¨ä¿®æ”¹ä¿¡æ¯æå–èŠ‚ç‚¹ä»£ç 
    - data:
        code: |
          import re
          def extract_info(text):
              patterns = {
                  "POL": r"POL[:ï¼š]?\s*([^\s,;]+)",
                  "POD": r"POD[:ï¼š]?\s*([^\s,;]+)",
                  "ETD": r"ETD[:ï¼š]?\s*([^\s,;]+)",
                  "ContainerType": r"Container Type[:ï¼š]?\s*([^\s,;]+)",
                  "Shipper": r"Shipper[:ï¼š]?\s*([^\s,;]+)",
                  "Carrier": r"Carrier[:ï¼š]?\s*([^\s,;]+)",
                  "VesselVoy": r"Vessel/Voy[:ï¼š]?\s*([^\s,;]+)",
                  "GrossWeight": r"Gross weight[:ï¼š]?\s*([^\s,;]+)"
              }
              extracted = {}
              missing_fields = []
              for field, pattern in patterns.items():
                  match = re.search(pattern, text, re.IGNORECASE)
                  extracted[field] = match.group(1).strip() if match else None
                  if not extracted[field]:
                      missing_fields.append(field)
              return extracted, missing_fields

          extracted_data, missing_fields = extract_info(user_input)
          # ğŸš¨ä¿®æ”¹è®¢å•å·ç”Ÿæˆè§„åˆ™
          import random
          order_number = f"SASS{random.randint(10000000, 99999999)}"
          output = {
              "extracted_data": extracted_data,
              "missing_fields": missing_fields,
              "order_number": order_number
          }
        # ...å…¶ä½™ä»£ç èŠ‚ç‚¹é…ç½®ä¿æŒä¸å˜...
    
    # ğŸš¨æ–°å¢é‚®ä»¶å‘é€èŠ‚ç‚¹
    - data:
        code: |
          import smtplib
          from email.mime.multipart import MIMEMultipart
          from email.mime.text import MIMEText
          from email.mime.application import MIMEApplication

          def send_email(pdf_path, order_info):
              msg = MIMEMultipart()
              msg['From'] = EMAIL_USER
              msg['To'] = 'booking@company.com'
              msg['Subject'] = f'æ–°è®¢èˆ±å• {order_info["order_number"]}'
              
              body = f'''å®Œæ•´è®¢å•ä¿¡æ¯ï¼š
              è®¢å•å·ï¼š{order_info['order_number']}
              POLï¼š{order_info['POL']}
              PODï¼š{order_info['POD']}
              ETDï¼š{order_info['ETD']}
              é›†è£…ç®±ç±»å‹ï¼š{order_info['ContainerType']}
              å‘è´§äººï¼š{order_info['Shipper']}
              æ‰¿è¿äººï¼š{order_info['Carrier']}
              èˆ¹åèˆªæ¬¡ï¼š{order_info['VesselVoy']}
              æ¯›é‡ï¼š{order_info['GrossWeight']}'''
              
              msg.attach(MIMEText(body, 'plain'))
              
              with open(pdf_path, 'rb') as f:
                  attach = MIMEApplication(f.read(), _subtype="pdf")
                  attach.add_header('Content-Disposition', 'attachment', filename=pdf_path)
                  msg.attach(attach)
              
              with smtplib.SMTP(SMTP_SERVER, int(SMTP_PORT)) as server:
                  server.starttls()
                  server.login(EMAIL_USER, EMAIL_PASSWORD)
                  server.send_message(msg)
              
              return True

          send_email(pdf_path, extracted_data.update({"order_number": order_number}))
          output = {"email_status": "success"}
        code_language: python3
        title: å‘é€é‚®ä»¶
        type: code
        # ...å…¶ä»–å¿…è¦é…ç½®...
      id: '1744044999999'
      # ...èŠ‚ç‚¹ä½ç½®é…ç½®...

    # ğŸš¨ä¿®æ”¹æ¡ä»¶åˆ¤æ–­é€»è¾‘
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: '>' 
            value: '0'
            variable_selector:
            - '1744042959072'
            - missing_fields
        # ...å…¶ä»–æ¡ä»¶é…ç½®...
    
    # ğŸš¨ä¿®æ”¹æœ€ç»ˆå›å¤èŠ‚ç‚¹
    - data:
        answer: |
          f"è®¢å•å·²ç”Ÿæˆå¹¶å‘é€è‡³é‚®ç®±ï¼\n
          è®¢å•å·ï¼š{{#1744042959072.order_number#}}\n
          PDFä¸‹è½½ï¼š{{#1744043997052.pdf_path#}}"
        type: answer
        # ...å…¶ä»–é…ç½®...
